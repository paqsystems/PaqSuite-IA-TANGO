# Internacionalización (i18n) - Frontend

## Descripción General

Este documento define la estrategia de internacionalización para el frontend del MVP Sistema de Registro de Tareas.

---

## Configuración

### Idioma por Defecto

- **Español (es)** - Idioma principal

### Idiomas Soportados

- **Español (es)** - Obligatorio
- **Inglés (en)** - Opcional para MVP

### Detección Automática de Idioma

**Especificación:** Al iniciar la aplicación, el sistema debe detectar automáticamente el idioma del navegador del usuario para establecer el idioma inicial.

**Prioridad de selección:**
1. **Idioma guardado en `localStorage`** (si existe) - Tiene prioridad máxima
2. **Idioma del navegador** (`navigator.language` o `navigator.languages[0]`) - Si no hay idioma guardado
3. **Español (es)** - Fallback por defecto si el idioma del navegador no está soportado

**Idiomas soportados para detección:**
- Si el navegador está en español (`es`, `es-ES`, `es-AR`, etc.) → Usar `es`
- Si el navegador está en inglés (`en`, `en-US`, `en-GB`, etc.) → Usar `en`
- Cualquier otro idioma → Usar `es` (fallback)

### Biblioteca Recomendada

**Por framework:**
- **React:** `react-i18next`

---

## Estructura de Archivos

```
frontend/src/locales/
├── es/
│   ├── common.json       # Textos comunes (botones, acciones)
│   ├── auth.json         # Autenticación
│   ├── tasks.json        # Tareas
│   ├── clients.json      # Clientes
│   ├── errors.json       # Mensajes de error
│   └── validation.json   # Mensajes de validación
└── en/
    └── (misma estructura)
```

---

## Convenciones de Nomenclatura

### Keys

Usar nombres descriptivos con puntos para jerarquía:

```
{modulo}.{seccion}.{elemento}
```

**Ejemplos:**
- `auth.login.title`
- `auth.login.submit`
- `tasks.create.form.date`
- `tasks.create.form.submit`
- `errors.validation.required`
- `errors.api.unauthorized`

### Valores

- Textos claros y concisos
- Usar mayúsculas solo cuando corresponda (títulos, nombres propios)
- Evitar jerga técnica en textos visibles al usuario

---

## Archivos de Traducción

### common.json

```json
{
  "actions": {
    "save": "Guardar",
    "cancel": "Cancelar",
    "delete": "Eliminar",
    "edit": "Editar",
    "create": "Crear",
    "search": "Buscar",
    "filter": "Filtrar",
    "close": "Cerrar",
    "back": "Volver"
  },
  "status": {
    "loading": "Cargando...",
    "success": "Éxito",
    "error": "Error",
    "noData": "No hay datos disponibles"
  },
  "pagination": {
    "previous": "Anterior",
    "next": "Siguiente",
    "page": "Página",
    "of": "de",
    "items": "elementos"
  }
}
```

### auth.json

```json
{
  "login": {
    "title": "Iniciar Sesión",
    "subtitle": "Ingresa tus credenciales para acceder",
    "usuario": {
      "label": "Código de Usuario",
      "placeholder": "Ingresa tu código de usuario"
    },
    "password": {
      "label": "Contraseña",
      "placeholder": "Ingresa tu contraseña"
    },
    "submit": "Iniciar Sesión",
    "errors": {
      "invalidCredentials": "Credenciales inválidas",
      "required": "Usuario y contraseña son obligatorios"
    }
  },
  "logout": {
    "button": "Cerrar Sesión",
    "confirm": "¿Estás seguro de que deseas cerrar sesión?"
  }
}
```

### tasks.json

```json
{
  "list": {
    "title": "Mis Tareas",
    "empty": "No hay tareas registradas",
    "filters": {
      "dateFrom": "Fecha desde",
      "dateTo": "Fecha hasta",
      "apply": "Aplicar filtros"
    }
  },
  "create": {
    "title": "Registrar Nueva Tarea",
    "form": {
      "date": {
        "label": "Fecha",
        "placeholder": "Selecciona la fecha"
      },
      "cliente": {
        "label": "Cliente",
        "placeholder": "Selecciona un cliente"
      },
      "tipoTarea": {
        "label": "Tipo de Tarea",
        "placeholder": "Selecciona un tipo"
      },
      "duracion": {
        "label": "Duración (minutos)",
        "placeholder": "Ingresa la duración"
      },
      "sinCargo": {
        "label": "Sin cargo",
        "help": "Marca si esta tarea no se factura al cliente"
      },
      "presencial": {
        "label": "Presencial",
        "help": "Marca si la tarea se realizó en el cliente"
      },
      "observacion": {
        "label": "Observación",
        "placeholder": "Observaciones adicionales (opcional)"
      },
      "submit": "Registrar Tarea",
      "cancel": "Cancelar"
    },
    "success": "Tarea registrada correctamente",
    "error": "Error al registrar la tarea"
  },
  "edit": {
    "title": "Editar Tarea",
    "success": "Tarea actualizada correctamente",
    "error": "Error al actualizar la tarea"
  },
  "delete": {
    "confirm": "¿Estás seguro de que deseas eliminar esta tarea?",
    "success": "Tarea eliminada correctamente",
    "error": "Error al eliminar la tarea"
  },
  "summary": {
    "title": "Resumen de Dedicación",
    "totalHours": "Total de Horas",
    "byClient": "Por Cliente",
    "noData": "No hay datos para el período seleccionado"
  }
}
```

### errors.json

```json
{
  "api": {
    "unauthorized": "No autorizado. Por favor, inicia sesión nuevamente",
    "forbidden": "No tienes permisos para realizar esta acción",
    "notFound": "Recurso no encontrado",
    "serverError": "Error del servidor. Por favor, intenta más tarde",
    "networkError": "Error de conexión. Verifica tu conexión a internet"
  },
  "validation": {
    "required": "Este campo es obligatorio",
    "invalidFormat": "Formato inválido",
    "dateFuture": "La fecha no puede ser futura",
    "minValue": "El valor debe ser mayor a {min}",
    "maxValue": "El valor debe ser menor a {max}",
    "maxLength": "Máximo {max} caracteres",
    "invalidEmail": "Email inválido"
  }
}
```

### validation.json

```json
{
  "date": {
    "required": "La fecha es obligatoria",
    "invalidFormat": "Formato de fecha inválido (YYYY-MM-DD)",
    "future": "La fecha no puede ser futura"
  },
  "cliente": {
    "required": "Debes seleccionar un cliente"
  },
  "tipoTarea": {
    "required": "Debes seleccionar un tipo de tarea"
  },
  "duracion": {
    "required": "La duración es obligatoria",
    "min": "La duración debe ser mayor a 0",
    "max": "La duración no puede exceder 1440 minutos (24 horas)"
  },
  "observacion": {
    "maxLength": "La observación no puede exceder 1000 caracteres"
  }
}
```

---

## Uso en Componentes

### React (react-i18next)

```typescript
import { useTranslation } from 'react-i18next';

function LoginForm() {
  const { t } = useTranslation(['auth', 'common']);
  
  return (
    <form>
      <label>{t('auth.login.usuario.label')}</label>
      <input 
        placeholder={t('auth.login.usuario.placeholder')}
        data-testid="login-form-usuario-input"
      />
      <button type="submit">
        {t('auth.login.submit')}
      </button>
    </form>
  );
}
```

### Vue (vue-i18n)

```vue
<template>
  <form>
    <label>{{ $t('auth.login.usuario.label') }}</label>
    <input 
      :placeholder="$t('auth.login.usuario.placeholder')"
      data-testid="login-form-usuario-input"
    />
    <button type="submit">
      {{ $t('auth.login.submit') }}
    </button>
  </form>
</template>
```

### Angular (@ngx-translate)

```typescript
import { TranslateService } from '@ngx-translate/core';

@Component({...})
export class LoginFormComponent {
  constructor(private translate: TranslateService) {}
  
  get usuarioLabel() {
    return this.translate.instant('auth.login.usuario.label');
  }
}
```

---

## Interpolación de Variables

### Ejemplo

```json
{
  "validation": {
    "minValue": "El valor debe ser mayor a {{min}}",
    "maxLength": "Máximo {{max}} caracteres"
  }
}
```

### Uso

```typescript
// React
t('validation.minValue', { min: 0 })
t('validation.maxLength', { max: 1000 })

// Resultado:
// "El valor debe ser mayor a 0"
// "Máximo 1000 caracteres"
```

---

## Pluralización

### Ejemplo

```json
{
  "tasks": {
    "count": {
      "zero": "No hay tareas",
      "one": "1 tarea",
      "other": "{{count}} tareas"
    }
  }
}
```

### Uso

```typescript
// React
t('tasks.count', { count: 0 })  // "No hay tareas"
t('tasks.count', { count: 1 })  // "1 tarea"
t('tasks.count', { count: 5 })  // "5 tareas"
```

---

## Textos que NO se Traducen

Los siguientes elementos **NO** deben traducirse:

- **Códigos de error técnicos:** `1101`, `3201`, etc.
- **IDs de base de datos:** IDs numéricos o UUIDs
- **Nombres de variables/campos técnicos:** `usuario_id`, `tipo_tarea_id`
- **Nombres de archivos o rutas técnicas**
- **Tokens o valores de configuración**

---

## Cambio de Idioma

### Ubicación del Selector

**Especificación:** El selector de idioma debe estar ubicado en el **Header/Navbar** de la aplicación, siempre visible y accesible para el usuario.

**Test ID:** `header.languageSelector`

### Implementación

```typescript
// Ejemplo React - Selector en Header/Navbar
import { useTranslation } from 'react-i18next';

function LanguageSelector() {
  const { i18n } = useTranslation();
  
  const changeLanguage = (lang: string) => {
    i18n.changeLanguage(lang);
    localStorage.setItem('language', lang);
  };
  
  return (
    <div data-testid="header.languageSelector" className="language-selector">
      <button 
        data-testid="header.languageSelector.es"
        onClick={() => changeLanguage('es')}
        className={i18n.language === 'es' ? 'active' : ''}
        aria-label="Español"
      >
        ES
      </button>
      <button 
        data-testid="header.languageSelector.en"
        onClick={() => changeLanguage('en')}
        className={i18n.language === 'en' ? 'active' : ''}
        aria-label="English"
      >
        EN
      </button>
    </div>
  );
}

// Alternativa: Selector tipo dropdown
function LanguageSelectorDropdown() {
  const { i18n } = useTranslation();
  
  const changeLanguage = (lang: string) => {
    i18n.changeLanguage(lang);
    localStorage.setItem('language', lang);
  };
  
  return (
    <select 
      data-testid="header.languageSelector"
      value={i18n.language}
      onChange={(e) => changeLanguage(e.target.value)}
      aria-label="Seleccionar idioma"
    >
      <option value="es">Español</option>
      <option value="en">English</option>
    </select>
  );
}
```

---

## Inicialización

### React (react-i18next)

```typescript
import i18n from 'i18next';
import { initReactI18next } from 'react-i18next';
import es from './locales/es/common.json';
import en from './locales/en/common.json';

/**
 * Detecta el idioma del navegador y lo convierte al código de idioma soportado
 * @returns Código de idioma soportado ('es' o 'en') o 'es' como fallback
 */
function detectBrowserLanguage(): string {
  // Prioridad 1: Idioma guardado en localStorage
  const savedLanguage = localStorage.getItem('language');
  if (savedLanguage && (savedLanguage === 'es' || savedLanguage === 'en')) {
    return savedLanguage;
  }
  
  // Prioridad 2: Idioma del navegador
  const browserLang = navigator.language || (navigator.languages && navigator.languages[0]) || 'es';
  const langCode = browserLang.split('-')[0].toLowerCase();
  
  // Si el idioma del navegador es español o inglés, usarlo
  if (langCode === 'es' || langCode === 'en') {
    return langCode;
  }
  
  // Prioridad 3: Fallback a español
  return 'es';
}

i18n
  .use(initReactI18next)
  .init({
    resources: {
      es: { common: es },
      en: { common: en }
    },
    lng: detectBrowserLanguage(),
    fallbackLng: 'es',
    interpolation: {
      escapeValue: false
    }
  });
  
// Guardar el idioma detectado en localStorage para futuras sesiones
localStorage.setItem('language', i18n.language);
```

---

## Testing

### Mock de Traducciones en Tests

```typescript
// Jest/Vitest
jest.mock('react-i18next', () => ({
  useTranslation: () => ({
    t: (key: string) => key,
    i18n: { changeLanguage: jest.fn() }
  })
}));
```

---

## Referencias

- `docs/frontend/frontend-specifications.md` - Especificaciones generales
- `.cursor/rules/10-i18n-and-testid.md` - Reglas de i18n y test-ids

---

**Última actualización:** 2025-01-20

